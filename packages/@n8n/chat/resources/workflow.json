{
  "name": "AI Webhook Chat",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "513107b3-6f3a-4a1e-af21-659f0ed14183",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "9b61171e-b575-4c2d-9429-00cf0ec934db",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -540,
        440
      ],
      "webhookId": "513107b3-6f3a-4a1e-af21-659f0ed14183"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "8c73ef7b-9787-44d2-9c45-d80e0cd3d9aa",
      "name": "Chat OpenAI",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        500,
        860
      ]
    },
    {
      "parameters": {
        "sessionKey": "={{ $json.body.sessionId }}"
      },
      "id": "321595b3-a42f-4bd6-9926-932b15394c15",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1,
      "position": [
        700,
        860
      ]
    },
    {
      "parameters": {
        "simplifyOutput": false
      },
      "id": "8f0aeec2-51ad-4467-acb1-bc820aa226f7",
      "name": "Memory Chat Retriever",
      "type": "@n8n/n8n-nodes-langchain.memoryChatRetriever",
      "typeVersion": 1,
      "position": [
        560,
        200
      ]
    },
    {
      "parameters": {
        "sessionKey": "={{ $json.body.sessionId }}"
      },
      "id": "33975f88-a7ed-4d6d-a4a5-e1522535a61b",
      "name": "Memory Chat Retriever Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1,
      "position": [
        580,
        400
      ]
    },
    {
      "parameters": {
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "sessionId",
                "value": "={{ $json.body.sessionId }}"
              }
            ]
          }
        }
      },
      "id": "7daef08b-cb05-4c4d-b505-a9c4f740e623",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1240,
        460
      ]
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.body.action }}",
        "rules": {
          "rules": [
            {
              "value2": "loadPreviousSession"
            },
            {
              "value2": "sendMessage",
              "output": 1
            }
          ]
        }
      },
      "id": "6ba27b1e-f6c1-426c-83f4-74c53e882ecc",
      "name": "Chatbot Action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        100,
        440
      ]
    },
    {
      "parameters": {
        "jsCode": "const response = { data: [] };\n\nfor (const item of $input.all()) {\n  response.data.push(item.json);\n}\n\nreturn {\n  json: response,\n  pairedItem: 0\n};"
      },
      "id": "fb8800f6-5e99-48ef-ae26-65c7feb27e64",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        940,
        200
      ]
    },
    {
      "parameters": {
        "text": "={{ $json.body.chat_input }}",
        "options": {}
      },
      "id": "0cbe0269-b74a-4bc4-8a5e-cd1d4875f0ad",
      "name": "Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1,
      "position": [
        560,
        580
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Chatbot Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memory Chat Retriever": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memory Chat Retriever Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "Memory Chat Retriever",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Chatbot Action": {
      "main": [
        [
          {
            "node": "Memory Chat Retriever",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat OpenAI": {
      "ai_languageModel": [
        [
          {
            "node": "Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": []
}
